<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Configurateur de Transition Alimentaire</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: Arial, sans-serif; margin: 2em; }
    .config-form { max-width: 400px; margin: auto; }
    label { display: block; margin-top: 1em; }
    input, select, button, textarea { width: 100%; padding: 0.5em; margin-top: 0.5em; }
    .calendar { margin-top: 2em; }
    .step { margin-bottom: 1em; padding: 1em; border: 1px solid #ccc; border-radius: 5px;}
    .newsletter { margin: 2em auto; max-width: 480px; }
    .success { color: green; margin-top: 1em; }
    .mention { font-size: 0.95em; color: #555; margin-top: 1em; text-align: center; }
  </style>
</head>
<body>
  <h1>Transition Alimentaire Chien ou Chat</h1>
  <form id="configForm" class="config-form">
    <label for="animal">Animal :</label>
    <select id="animal" name="animal" required>
      <option value="">--Choisir--</option>
      <option value="chien">Chien</option>
      <option value="chat">Chat</option>
    </select>
    <label for="currentBrand">Marque actuelle :</label>
    <input type="text" id="currentBrand" name="currentBrand" required placeholder="Ex : Royal Canin">
    <label for="newBrand">Nouvelle marque ou 'fait maison' :</label>
    <input type="text" id="newBrand" name="newBrand" required placeholder="Ex : Purina ou fait maison">
    <label for="duration">Durée de transition (jours) :</label>
    <select id="duration" name="duration">
      <option value="7">7 jours</option>
      <option value="10">10 jours</option>
      <option value="14">14 jours</option>
    </select>
    <label for="userEmail">Votre email :</label>
    <input type="email" id="userEmail" name="userEmail" required placeholder="votre@email.com">
    <button type="submit">Recevoir mon calendrier par email</button>
    <div class="mention">
      Vous serez inscrit à notre newsletter "Observatoire des Pattounes", vous pourrez vous désinscrire à tout moment.
    </div>
    <div id="formSuccess" class="success"></div>
  </form>
  <div id="calendar" class="calendar"></div>
  <!-- Bloc newsletter kessel -->
  <div class="newsletter">
    <h2>S'inscrire à la newsletter : conseils & rappels</h2>
    <iframe
      src="https://animodom.kessel.media/iframe" width="480" height="320"
      frameborder="0"
      scrolling="no">
    </iframe>
    <p style="font-size:0.9em;color:#666;text-align:center;">
      Votre email sera utilisé uniquement pour l’envoi des conseils et du calendrier.
    </p>
  </div>
  <script>
    function getTransitionSteps(duration) {
      const steps = [];
      const phases = [
        { ratio: 0.75, label: "75% ancienne, 25% nouvelle" },
        { ratio: 0.5, label: "50% ancienne, 50% nouvelle" },
        { ratio: 0.25, label: "25% ancienne, 75% nouvelle" },
        { ratio: 0.0, label: "100% nouvelle alimentation" }
      ];
      const daysPerPhase = Math.floor(duration / phases.length);
      let day = 1;
      for (let i = 0; i < phases.length; i++) {
        let startDay = day;
        let endDay = i === phases.length - 1 ? duration : day + daysPerPhase - 1;
        steps.push({
          label: phases[i].label,
          from: startDay,
          to: endDay,
          advice: getAdvice(phases[i].ratio)
        });
        day = endDay + 1;
      }
      return steps;
    }
    function getAdvice(ratio) {
      if (ratio === 0.75) return "Surveillez les selles et l’appétit. Premiers changements, soyez attentif à tout signe de gêne digestive.";
      if (ratio === 0.5) return "Continuez la surveillance. Si tout va bien, vous pouvez poursuivre.";
      if (ratio === 0.25) return "La majorité de la nouvelle alimentation est introduite. Restez attentif aux réactions.";
      if (ratio === 0.0) return "La transition est terminée ! Continuez à surveiller pendant quelques jours.";
      return "";
    }

    document.getElementById('configForm').onsubmit = async function(e) {
      e.preventDefault();
      const animal = document.getElementById('animal').value;
      const currentBrand = document.getElementById('currentBrand').value;
      const newBrand = document.getElementById('newBrand').value;
      const duration = parseInt(document.getElementById('duration').value);
      const userEmail = document.getElementById('userEmail').value;

      const steps = getTransitionSteps(duration);
      let html = `<h2>Calendrier de transition pour votre ${animal}</h2>`;
      html += `<p>De ${currentBrand} vers ${newBrand} sur ${duration} jours.</p>`;
      steps.forEach(step => {
        html += `<div class="step">
          Jours ${step.from} à ${step.to} : ${step.label}<br>
          <em>Conseil :</em> ${step.advice}
        </div>`;
      });
      html += "<p>Conseils généraux : Si votre animal présente des signes de troubles digestifs (diarrhée, vomissements, perte d’appétit), ralentissez la transition ou consultez votre vétérinaire.</p>";
      document.getElementById('calendar').innerHTML = html;

      // Envoi du calendrier par email via Formspree
      // Remplace 'YOUR_FORMSPREE_ENDPOINT' par ton endpoint Formspree (ex: https://formspree.io/f/moqpaggr)
      const formData = new FormData();
      formData.append("email", userEmail);
      formData.append("message", html.replace(/<[^>]+>/g, "\n")); // version texte du calendrier

      try {
        const response = await fetch("YOUR_FORMSPREE_ENDPOINT", {
          method: "POST",
          body: formData,
          headers: { 'Accept': 'application/json' }
        });
        if (response.ok) {
          document.getElementById('formSuccess').textContent = "Le calendrier vient d'être envoyé à votre email !";
          document.getElementById('configForm').reset();
        } else {
          document.getElementById('formSuccess').textContent = "Erreur lors de l'envoi. Réessayez ou contactez-nous.";
        }
      } catch (err) {
        document.getElementById('formSuccess').textContent = "Erreur technique. Réessayez plus tard.";
      }
    };
  </script>
</body>
</html>
